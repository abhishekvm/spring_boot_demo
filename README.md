# Spring Security Demo

This app showcases various abilities of spring security and oauth.

## Perquisites
 - Add `client-id` and `client-secret` in the application.yml file for the Google app used for Oauth.
 - A MySQL server running on default ports with a database named `demo1`.
 - A running ZAP server running on port `8081` with api_key setup as `zap_key`.
 
## Starting the app
Just run `gradle bootRun` to start the app. It creates several tables for different entities and bootstraps 3 roles, 
ADMIN, DEVELOPER and SECURITY.

## Testing the app

### Registering a user

`register` GET endpoint can be used to register a new user. For example, the following GET call with the given params register a new user with a DEVELOPER role.

`http localhost:8080/register name==John email==john.doe@anon.com organization==anon.com password==1212 role==DEVELOPER`

Similarly, other kinds if users can be registered.

### Logging In

Try accessing `/admin`, `/security` endpoints or any other endpoint from a new browser session and it will redirect to the 
Google Oauth login page. Login by entering your Google creds.

### Testing authorization

Authorization of different roles can be tested by accessing the home endpoints for each type of user. For admin user, its `/admin` and
`/developer` and `/security` for DEVELOPER and SECURITY roles respectively. 
An admin user should be able to access all the endpoints while other users can only access their landing pages entity listing endpoints generated by Spring data rest.

### Custom Token Generation

Admin users can generate token for anyone in the same organization to ingest data from a ZAP server. To generate a token,
use the following get endpoint with an admin user.

`http://localhost:8080/generate?email=john.doe@anon.com`

This will generate and return an access token that is valid for 60 minutes.

### Using the token

Before using the token to ingest data from the ZAP server, we need to run an scan so that there is something to ingest.
To run a scan, hit the following endpoint with an admin user.

`http://localhost:8080/zap_scan?url=https://public-firing-range.appspot.com`

The url here is of a vulnerable deployment that can be scanned.

Now as we have a scan done, we can ingest it's report using the token generated above. To get the report, just hit the following endpoint:

`http localhost:8080/zap_report 'Authorization:Bearer <Token>'`

It's a GET with request with an authorization containing the token. This endpoint will return the path of an HTML file which is the scan report.

### Monitoring the activity

Admin users can also monitor the activity of the application. The following endpoint will return a simple HTML table listing
all the action performed by different user the application chronologically.

`http://localhost:8080/history`

